---
openapi: 3.0.1
info:
  title: Movie Explorer API V1
  version: v1
paths:
  "/api/v1/users":
    post:
      summary: User created
      tags:
      - Users
      parameters: []
      responses:
        '422':
          description: returns a 422 response
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    first_name:
                      type: string
                    last_name:
                      type: string
                    email:
                      type: string
                      format: email
                    password:
                      type: string
                    mobile_number:
                      type: string
                  required:
                  - first_name
                  - last_name
                  - email
                  - password
                  - mobile_number
  "/api/v1/users/sign_in":
    post:
      summary: Sign in a user
      tags:
      - Users
      parameters: []
      responses:
        '200':
          description: User signed in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  email:
                    type: string
                  first_name:
                    type: string
                  last_name:
                    type: string
                  mobile_number:
                    type: string
                  role:
                    type: string
                    enum:
                    - user
                    - supervisor
                    - admin
                  token:
                    type: string
                required:
                - id
                - email
                - first_name
                - last_name
                - mobile_number
                - role
                - token
        '401':
          description: Invalid email or password
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                    password:
                      type: string
                  required:
                  - email
                  - password
              required:
              - user
  "/api/v1/movies":
    get:
      summary: List movies
      tags:
      - Movies
      parameters:
      - name: page
        in: query
        required: false
        description: Page number
        schema:
          type: integer
      responses:
        '200':
          description: Movies retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  movies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        title:
                          type: string
                        genre:
                          type: string
                        release_year:
                          type: integer
                        rating:
                          type: number
                        director:
                          type: string
                        duration:
                          type: integer
                        main_lead:
                          type: string
                        streaming_platform:
                          type: string
                          enum:
                          - Netflix
                          - Amazon Prime
                          - Disney+
                        description:
                          type: string
                        plan:
                          type: string
                          enum:
                          - basic
                          - premium
                        poster_url:
                          type: string
                          nullable: true
                        banner_url:
                          type: string
                          nullable: true
                      required:
                      - id
                      - title
                      - genre
                      - release_year
                      - rating
                      - director
                      - duration
                      - main_lead
                      - streaming_platform
                      - description
                      - plan
                  total_pages:
                    type: integer
                  current_page:
                    type: integer
                required:
                - movies
                - total_pages
                - current_page
    post:
      summary: Create a movie
      tags:
      - Movies
      security:
      - Bearer: []
      description: Creates a movie with poster and banner image uploads. Triggers
        FCM notification to premium users if the movie is premium.
      parameters: []
      responses:
        '201':
          description: Movie created
        '422':
          description: Invalid request
        '403':
          description: Forbidden
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                genre:
                  type: string
                release_year:
                  type: integer
                rating:
                  type: number
                  format: float
                director:
                  type: string
                duration:
                  type: integer
                main_lead:
                  type: string
                streaming_platform:
                  type: string
                  enum:
                  - Netflix
                  - Amazon Prime
                  - Disney+
                description:
                  type: string
                premium:
                  type: boolean
                poster:
                  type: string
                  format: binary
                  description: Poster image file (e.g., JPEG, PNG)
                banner:
                  type: string
                  format: binary
                  description: Banner image file (e.g., JPEG, PNG)
              required:
              - title
              - genre
              - release_year
              - rating
              - director
              - duration
              - main_lead
              - streaming_platform
              - description
              - premium
  "/api/v1/movies/{id}":
    get:
      summary: Retrieve a movie
      tags:
      - Movies
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: Movie retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  title:
                    type: string
                  genre:
                    type: string
                  release_year:
                    type: integer
                  rating:
                    type: number
                  director:
                    type: string
                  duration:
                    type: integer
                  main_lead:
                    type: string
                  streaming_platform:
                    type: string
                    enum:
                    - Netflix
                    - Amazon Prime
                    - Disney+
                  description:
                    type: string
                  plan:
                    type: string
                    enum:
                    - basic
                    - premium
                  poster_url:
                    type: string
                    nullable: true
                  banner_url:
                    type: string
                    nullable: true
                required:
                - id
                - title
                - genre
                - release_year
                - rating
                - director
                - duration
                - main_lead
                - streaming_platform
                - description
                - plan
        '404':
          description: Movie not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    patch:
      summary: Update a movie
      tags:
      - Movies
      security:
      - Bearer: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: Movie updated
        '422':
          description: Invalid request
        '403':
          description: Forbidden
        '404':
          description: Not Found
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                  nullable: true
                genre:
                  type: string
                  nullable: true
                release_year:
                  type: integer
                  nullable: true
                rating:
                  type: number
                  format: float
                  nullable: true
                director:
                  type: string
                  nullable: true
                duration:
                  type: integer
                  nullable: true
                main_lead:
                  type: string
                  nullable: true
                streaming_platform:
                  type: string
                  enum:
                  - Netflix
                  - Amazon Prime
                  - Disney+
                  nullable: true
                description:
                  type: string
                  nullable: true
                premium:
                  type: boolean
                  nullable: true
                poster:
                  type: string
                  format: binary
                  description: Poster image file (e.g., JPEG, PNG)
                  nullable: true
                banner:
                  type: string
                  format: binary
                  description: Banner image file (e.g., JPEG, PNG)
                  nullable: true
    delete:
      summary: Delete a movie
      tags:
      - Movies
      security:
      - Bearer: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '204':
          description: Movie deleted
        '404':
          description: Movie not found
        '403':
          description: Forbidden
  "/api/v1/movies/{genre}":
    get:
      summary: List movies by genre
      tags:
      - Movies
      parameters:
      - name: genre
        in: path
        required: true
        schema:
          type: string
      - name: page
        in: query
        required: false
        description: Page number
        schema:
          type: integer
      responses:
        '200':
          description: Movies retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  movies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        title:
                          type: string
                        genre:
                          type: string
                        release_year:
                          type: integer
                        rating:
                          type: number
                        director:
                          type: string
                        duration:
                          type: integer
                        main_lead:
                          type: string
                        streaming_platform:
                          type: string
                          enum:
                          - Netflix
                          - Amazon Prime
                          - Disney+
                        description:
                          type: string
                        plan:
                          type: string
                          enum:
                          - basic
                          - premium
                        poster_url:
                          type: string
                          nullable: true
                        banner_url:
                          type: string
                          nullable: true
                      required:
                      - id
                      - title
                      - genre
                      - release_year
                      - rating
                      - director
                      - duration
                      - main_lead
                      - streaming_platform
                      - description
                      - plan
                  total_pages:
                    type: integer
                  current_page:
                    type: integer
                required:
                - movies
                - total_pages
                - current_page
  "/api/v1/subscriptions":
    post:
      summary: Creates a subscription
      tags:
      - Subscriptions
      security:
      - Bearer: []
      parameters: []
      responses:
        '201':
          description: subscription created
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                subscription:
                  type: object
                  properties:
                    start_date:
                      type: string
                      format: date-time
                    end_date:
                      type: string
                      format: date-time
                    premium:
                      type: boolean
                    active:
                      type: boolean
                  required:
                  - start_date
                  - premium
                  - active
  "/api/v1/subscriptions/{id}":
    patch:
      summary: Updates a subscription
      tags:
      - Subscriptions
      security:
      - Bearer: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: subscription updated
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                subscription:
                  type: object
                  properties:
                    start_date:
                      type: string
                      format: date-time
                    end_date:
                      type: string
                      format: date-time
                    premium:
                      type: boolean
                    active:
                      type: boolean
    delete:
      summary: Deletes a subscription
      tags:
      - Subscriptions
      security:
      - Bearer: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '204':
          description: subscription deleted
        '401':
          description: unauthorized
  "/api/v1/users/sign_out":
    post:
      summary: Sign out a user
      tags:
      - Users
      security:
      - Bearer: []
      responses:
        '200':
          description: User signed out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  "/api/v1/users/{id}":
    get:
      summary: Retrieve a user
      tags:
      - Users
      security:
      - Bearer: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  email:
                    type: string
                  first_name:
                    type: string
                  last_name:
                    type: string
                  mobile_number:
                    type: string
                  role:
                    type: string
                    enum:
                    - user
                    - supervisor
                    - admin
                required:
                - id
                - email
                - first_name
                - last_name
                - mobile_number
                - role
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    patch:
      summary: Update a user
      tags:
      - Users
      security:
      - Bearer: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  email:
                    type: string
                  first_name:
                    type: string
                  last_name:
                    type: string
                  mobile_number:
                    type: string
                  role:
                    type: string
                    enum:
                    - user
                    - supervisor
                    - admin
                required:
                - id
                - email
                - first_name
                - last_name
                - mobile_number
                - role
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '422':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    first_name:
                      type: string
                    last_name:
                      type: string
                    email:
                      type: string
                    mobile_number:
                      type: string
                    password:
                      type: string
              required:
              - user
  "/api/v1/users/update_device_token":
    post:
      summary: Update device token
      tags:
      - Users
      security:
      - Bearer: []
      parameters: []
      responses:
        '200':
          description: Device token updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '422':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                device_token:
                  type: string
              required:
              - device_token
  "/api/v1/users/update_notification_preference":
    patch:
      summary: Update notification preference
      tags:
      - Users
      security:
      - Bearer: []
      parameters: []
      responses:
        '200':
          description: Notification preference updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '422':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notification_enabled:
                  type: boolean
              required:
              - notification_enabled
servers:
- url: http://localhost:3000
  description: Local server
- url: https://movie-explorer-ror-agrim.onrender.com
  description: Production server
components:
  schemas:
    user:
      type: object
      properties:
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
        mobile_number:
          type: string
      required:
      - first_name
      - last_name
      - email
      - password
      - mobile_number
  securitySchemes:
    Bearer:
      type: http
      scheme: bearer
      bearerFormat: JWT
security:
- Bearer: []
